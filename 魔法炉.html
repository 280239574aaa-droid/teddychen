<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç§˜é­”æ³•ç†”ç‚‰</title>
    <style>
        :root {
            --bg-color: #1a0b2e;
            --text-color: #e0d4fc;
            
            /* èƒ½é‡ç­‰çº§é¢œè‰² */
            --color-lv0: #7f8c8d; 
            --color-lv1: #0984e3; 
            --color-lv2: #e84393; 
            --color-lv3: #fdcb6e; 
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex; flex-direction: column;
            align-items: center;
            min-height: 100vh; margin: 0; padding: 20px;
            user-select: none;
        }

        /* é¡¶éƒ¨ä¿¡æ¯ */
        .header {
            width: 100%; max-width: 420px;
            display: flex; justify-content: space-between;
            margin-bottom: 20px; padding: 10px;
            background: rgba(0,0,0,0.3); border-radius: 10px;
            font-size: 14px;
        }

        /* --- ç†”ç‚‰åŒºåŸŸ --- */
        .furnace-wrapper {
            position: relative;
            width: 200px; height: 200px;
            margin-bottom: 20px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
        }

        .furnace {
            font-size: 100px;
            transition: all 0.5s ease;
            position: relative; z-index: 2;
            filter: drop-shadow(0 0 5px var(--color-lv0)) grayscale(0.8);
            transform: scale(0.9);
        }

        /* ç†”ç‚‰ç‰¹æ•ˆçŠ¶æ€ */
        .furnace.lv0 { filter: drop-shadow(0 0 5px var(--color-lv0)) grayscale(0.5); }
        .furnace.lv1 { filter: drop-shadow(0 0 15px var(--color-lv1)); animation: breathe 3s infinite ease-in-out; }
        .furnace.lv2 { filter: drop-shadow(0 0 25px var(--color-lv2)); animation: pulse 2s infinite ease-in-out; }
        .furnace.lv3 { filter: drop-shadow(0 0 40px var(--color-lv3)) brightness(1.2); animation: shake-glow 1s infinite alternate; }
        .furnace.smelting { animation: hard-shake 0.3s infinite !important; }

        /* æ¦‚ç‡æç¤º Tooltip */
        .tooltip-base {
            position: absolute; 
            background: rgba(0,0,0,0.95); border: 1px solid #666;
            padding: 10px 15px; border-radius: 8px; font-size: 12px;
            text-align: left; opacity: 0; transition: all 0.3s;
            pointer-events: none; z-index: 20;
        }
        .tooltip-base.show { opacity: 1; pointer-events: auto; }
        .tooltip-base div { margin-bottom: 4px; display: flex; justify-content: space-between; gap: 10px; }

        .prob-tooltip {
            top: -70px; width: 180px; transform: translateY(10px); left: 50%; margin-left: -105px; /* å±…ä¸­ */
        }
        .prob-tooltip.show { transform: translateY(0); }
        
        .click-hint { position: absolute; bottom: 0; font-size: 10px; color: rgba(255,255,255,0.4); pointer-events: none; }

        @keyframes breathe { 50% { transform: scale(1.05); filter: drop-shadow(0 0 25px var(--color-lv1)); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); filter: drop-shadow(0 0 35px var(--color-lv2)); } 100% { transform: scale(1); } }
        @keyframes shake-glow { from { transform: rotate(-2deg) scale(1.1); } to { transform: rotate(2deg) scale(1.15); filter: drop-shadow(0 0 50px var(--color-lv3)); } }
        @keyframes hard-shake { 0% { transform: translate(2px, 2px); } 25% { transform: translate(-2px, -2px); } 50% { transform: translate(2px, -2px); } 75% { transform: translate(-2px, 2px); } }

        /* --- ä¸­é—´æ ¸å¿ƒåŒº --- */
        .input-section {
            display: flex; align-items: center; justify-content: center;
            gap: 15px; margin-bottom: 10px;
            background: rgba(255,255,255,0.03); padding: 15px 25px; border-radius: 20px;
        }

        .slot {
            width: 60px; height: 60px;
            background: rgba(255,255,255,0.05); border: 2px dashed #666; border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-size: 28px; transition: all 0.3s;
        }
        .slot.filled {
            background: rgba(255,255,255,0.1); border-style: solid; border-color: var(--text-color);
            box-shadow: 0 0 10px rgba(255,255,255,0.2); animation: slot-pop 0.3s;
        }
        @keyframes slot-pop { 50% { transform: scale(1.2); } }

        /* é‚€è¯· Icon */
        .btn-invite-icon {
            width: 45px; height: 45px; border-radius: 50%;
            background: #0984e3; border: 2px solid rgba(255,255,255,0.3); color: white;
            font-size: 24px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 10px rgba(9, 132, 227, 0.4);
            transition: transform 0.2s, background 0.2s; position: relative;
        }
        .btn-invite-icon:hover { background: #74b9ff; transform: scale(1.1); }
        .btn-invite-icon:active { transform: scale(0.9); }
        .invite-label {
            position: absolute; top: -25px; 
            font-size: 10px; background: #e17055; padding: 2px 6px; border-radius: 4px;
            white-space: nowrap; animation: float-label 2s infinite;
        }
        @keyframes float-label { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-3px);} }

        /* åŠ©åŠ›å¤´åƒ */
        .helper-container {
            height: 40px; margin-bottom: 25px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .helper-avatar {
            width: 30px; height: 30px; background: #333;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 2px solid transparent; transition: all 0.3s; font-size: 14px;
        }
        .helper-avatar.active { border-color: var(--color-lv1); background: #2d3436; box-shadow: 0 0 8px var(--color-lv1); }

        /* --- åº•éƒ¨æ“ä½œæ  (3æŒ‰é’®å¹¶æ’) --- */
        .action-row {
            display: flex; width: 100%; max-width: 420px;
            gap: 10px; align-items: stretch;
            height: 56px; /* å›ºå®šé«˜åº¦ç¡®ä¿å¯¹é½ */
        }

        .btn {
            flex: 1; border: none; border-radius: 12px;
            font-weight: bold; font-size: 14px; cursor: pointer; color: white;
            transition: transform 0.1s, filter 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
        }
        .btn:active { transform: scale(0.96); }
        .btn:disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }

        /* æŠ•å…¥æŒ‰é’® */
        .btn-add {
            background: #636e72; box-shadow: 0 4px 0 #2d3436;
            flex: 0.8; /* ç¨å¾®çª„ä¸€ç‚¹ */
            font-size: 14px; flex-direction: row; gap: 5px;
        }

        /* ç†”ç‚¼æŒ‰é’® */
        .btn-smelt {
            background: linear-gradient(to bottom, #d63031, #c0392b); 
            box-shadow: 0 4px 0 #b33939; 
            flex: 1.2; /* æœ€å®½ */
            font-size: 16px; flex-direction: row; gap: 5px;
        }

        /* åŠ©åŠ›æŒ‰é’® (æ–°æ ·å¼) */
        .help-wrapper {
            position: relative; flex: 0.8; /* ä¸æŠ•å…¥æŒ‰é’®åŒå®½ */
        }
        
        .btn-help {
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            box-shadow: 0 4px 0 #5f27cd;
            line-height: 1.2;
        }
        
        .btn-sub-text {
            font-size: 10px; opacity: 0.8; font-weight: normal;
        }

        /* Tips å°é—®å·è§’æ ‡ */
        .help-tip-badge {
            position: absolute; top: -8px; right: -5px;
            width: 20px; height: 20px; background: #e17055;
            border-radius: 50%; border: 2px solid var(--bg-color);
            color: white; font-size: 12px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .help-tip-badge:hover { transform: scale(1.1); background: #fab1a0; }

        /* Tips å¼¹çª— (å®šä½åœ¨æŒ‰é’®ä¸Šæ–¹) */
        .help-rewards-tooltip {
            bottom: 70px; right: 0; width: 140px;
            transform: translateY(10px);
        }
        .help-rewards-tooltip.show { transform: translateY(0); }


        /* è°ƒè¯•ä¸æç¤º */
        .debug-area { margin-top: 40px; border-top: 1px dashed #444; padding-top: 15px; width: 100%; max-width: 400px; text-align: center; }
        .log-box {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(0,0,0,0.85); color: #fff;
            padding: 12px 24px; border-radius: 30px; border: 1px solid #777;
            pointer-events: none; opacity: 0; transition: all 0.3s; z-index: 100;
        }
        .log-box.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        .res-fail { color: #b2bec3; }
        .res-success { color: #55efc4; }
        .res-great { color: #fdcb6e; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <div>ğŸ”¥ å‰©ä½™æ¬¡æ•°: <span id="daily-limit">10</span>/10</div>
        <div>ğŸ’ ä¸‡èƒ½é“å…·: <span id="universal-count" style="color:#fdcb6e">0</span></div>
    </div>

    <!-- ç†”ç‚‰ä¸»ä½“ -->
    <div class="furnace-wrapper" onclick="toggleProbability()">
        <div class="tooltip-base prob-tooltip" id="prob-tooltip">
            <div style="margin-bottom:8px; color:#aaa; font-size:10px;">å½“å‰èƒ½é‡ç­‰çº§: <span id="level-text">LV.0</span></div>
            <div><span class="res-fail">â— å¤±è´¥ (è¿”è¿˜1)</span> <span id="prob-fail">60%</span></div>
            <div><span class="res-success">â— æˆåŠŸ (è·å¾—1)</span> <span id="prob-success">35%</span></div>
            <div><span class="res-great">â— å¤§æˆåŠŸ (è·å¾—1è¿”1)</span> <span id="prob-great">5%</span></div>
        </div>
        
        <div class="furnace lv0" id="furnace">ğŸº</div>
        <div class="click-hint">ğŸ‘† ç‚¹å‡»æŸ¥çœ‹æ¦‚ç‡</div>
    </div>

    <!-- ä¸­é—´ï¼šæ§½ä½ + é‚€è¯·Icon -->
    <div class="input-section">
        <div class="slot" id="slot-1"></div>
        <div class="slot" id="slot-2"></div>
        <button class="btn-invite-icon" onclick="shareToChat()" title="é‚€è¯·å¥½å‹åŠ©åŠ›">
            <div class="invite-label">é‚€è¯·</div>
            â•
        </button>
    </div>

    <!-- åŠ©åŠ›å¤´åƒ -->
    <div class="helper-container">
        <div style="font-size:12px; color:#888; margin-right:10px;">å¥½å‹åŠ©åŠ›:</div>
        <div class="helper-avatar" id="helper-1"></div>
        <div class="helper-avatar" id="helper-2"></div>
        <div class="helper-avatar" id="helper-3"></div>
    </div>
    <div style="font-size: 12px; color: #666; margin-bottom: 20px;">éœ€æŠ•å…¥ 2 ä¸ªæ™®é€šé“å…· (æŒæœ‰: <span id="normal-count">99</span>)</div>

    <!-- åº•éƒ¨æŒ‰é’®æ ï¼šæŠ•å…¥ | ç†”ç‚¼ | åŠ©åŠ› -->
    <div class="action-row">
        <!-- 1. æŠ•å…¥ -->
        <button class="btn btn-add" id="btn-add" onclick="addItem()">
            <span>ğŸ“¥ æŠ•å…¥</span>
        </button>

        <!-- 2. ç†”ç‚¼ -->
        <button class="btn btn-smelt" id="btn-smelt" onclick="startSmelt()" disabled>
            <span>ğŸ”¥ å¼€å§‹ç†”ç‚¼</span>
        </button>

        <!-- 3. åŠ©åŠ› (åŒ…å«Tooltipç»“æ„) -->
        <div class="help-wrapper">
            <!-- å¥–åŠ±è¯´æ˜ Tips å¼¹çª— -->
            <div class="tooltip-base help-rewards-tooltip" id="help-rewards-tooltip">
                <div style="color:#fdcb6e; font-weight:bold; margin-bottom:5px;">ğŸ åŠ©åŠ›å¥–åŠ±æ¦‚ç‡</div>
                <div><span>ğŸª™ é‡‘å¸</span> <span>50%</span></div>
                <div><span>âš¡ ä½“åŠ›</span> <span>30%</span></div>
                <div><span>ğŸ§ª é“å…·</span> <span>20%</span></div>
            </div>

            <!-- å³ä¸Šè§’é—®å·è§’æ ‡ -->
            <div class="help-tip-badge" onclick="toggleHelpRewards(event)">?</div>

            <!-- ä¸»æŒ‰é’® -->
            <button class="btn btn-help" onclick="goToChat()">
                <span>ğŸš€ å‰å¾€åŠ©åŠ›</span>
                <span class="btn-sub-text">å¯é¢†å¥– <span id="my-rewards-count">0</span>/5</span>
            </button>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿæ“ä½œ -->
    <div class="debug-area">
        <button class="btn" style="background:#00b894; font-size:12px; padding:8px; flex-direction: row;" onclick="simulateFriendHelp()">
            ğŸ¤ æ¨¡æ‹Ÿ: æœ‰äººå¸®äº†æˆ‘ (+1 èƒ½é‡)
        </button>
    </div>

    <div class="log-box" id="toast">æç¤ºä¿¡æ¯</div>

    <script>
        // --- æ ¸å¿ƒé…ç½® ---
        const PROB_TABLE = [
            { fail: 60, success: 35, great: 5,  name: "LV.0 é»¯æ·¡" },
            { fail: 40, success: 50, great: 10, name: "LV.1 å¾®å…‰" },
            { fail: 20, success: 55, great: 25, name: "LV.2 å……ç›ˆ" },
            { fail: 5,  success: 45, great: 50, name: "LV.3 ç‹‚æš´" }
        ];

        let state = {
            normalItems: 99,
            universalItems: 0,
            attemptsLeft: 10,
            inputSlots: 0,
            helpers: 0,
            isSmelting: false,
            myRewardsReceived: 0
        };

        const el = {
            furnace: document.getElementById('furnace'),
            probTooltip: document.getElementById('prob-tooltip'),
            helpTooltip: document.getElementById('help-rewards-tooltip'),
            dailyLimit: document.getElementById('daily-limit'),
            normalCount: document.getElementById('normal-count'),
            universalCount: document.getElementById('universal-count'),
            btnAdd: document.getElementById('btn-add'),
            btnSmelt: document.getElementById('btn-smelt'),
            toast: document.getElementById('toast'),
            myRewardsCount: document.getElementById('my-rewards-count'),
            // Stats
            levelText: document.getElementById('level-text'),
            probFail: document.getElementById('prob-fail'),
            probSuccess: document.getElementById('prob-success'),
            probGreat: document.getElementById('prob-great')
        };

        // --- 1. æŠ•å…¥é“å…· ---
        function addItem() {
            if (state.isSmelting) return;
            if (state.inputSlots >= 2) return showToast("æ§½ä½å·²æ»¡");
            if (state.normalItems <= 0) return showToast("é“å…·ä¸è¶³");
            state.normalItems--;
            state.inputSlots++;
            updateUI();
        }

        // --- 2. æ¨¡æ‹Ÿå¥½å‹åŠ©åŠ› ---
        function simulateFriendHelp() {
            if (state.isSmelting) return showToast("ç†”ç‚¼ä¸­...");
            if (state.helpers >= 3) return showToast("èƒ½é‡å·²è¾¾ä¸Šé™ï¼");
            state.helpers++;
            showToast("å¥½å‹åŠ©åŠ›æˆåŠŸï¼èƒ½é‡æå‡ï¼");
            updateUI();
        }

        // --- 3. é‚€è¯·åˆ†äº« ---
        function shareToChat() {
            showToast("ğŸ”— é‚€è¯·é“¾æ¥å·²å¤åˆ¶ï¼");
        }

        // --- 4. å‰å¾€åŠ©åŠ› ---
        function goToChat() {
            showToast("æ­£åœ¨å‰å¾€èŠå¤©é¢‘é“...");
        }

        function toggleHelpRewards(e) {
            e.stopPropagation(); // é˜²æ­¢è§¦å‘æŒ‰é’®ç‚¹å‡»æˆ–å†’æ³¡
            el.helpTooltip.classList.toggle('show');
            if (el.helpTooltip.classList.contains('show')) {
                setTimeout(() => el.helpTooltip.classList.remove('show'), 3000);
            }
        }

        // --- 5. ç†”ç‚¼é€»è¾‘ ---
        function startSmelt() {
            if (state.isSmelting) return;
            if (state.inputSlots < 2) return;
            if (state.attemptsLeft <= 0) return showToast("ä»Šæ—¥æ¬¡æ•°å·²ç”¨å®Œ");

            state.isSmelting = true;
            state.attemptsLeft--;
            el.btnSmelt.disabled = true;
            el.btnAdd.disabled = true;
            
            el.furnace.classList.add('smelting');
            el.furnace.innerText = "ğŸ”¥";
            el.probTooltip.classList.remove('show');

            setTimeout(() => {
                const result = calculateResult();
                processResult(result);
            }, 2000);
        }

        function calculateResult() {
            const probs = PROB_TABLE[state.helpers];
            const rand = Math.random() * 100;
            if (rand < probs.fail) return 'fail';
            if (rand < probs.fail + probs.success) return 'success';
            return 'great';
        }

        function processResult(type) {
            el.furnace.classList.remove('smelting');
            let msg = "";
            if (type === 'fail') {
                el.furnace.innerText = "ğŸ’¨";
                state.normalItems += 1;
                msg = "ç†”ç‚¼å¤±è´¥...è¿”è¿˜ 1 ä¸ªæ™®é€šé“å…·";
            } else if (type === 'success') {
                el.furnace.innerText = "ğŸ’";
                state.universalItems += 1;
                msg = "ç†”ç‚¼æˆåŠŸï¼è·å¾— 1 ä¸ªä¸‡èƒ½é“å…·";
            } else if (type === 'great') {
                el.furnace.innerText = "ğŸŒŸ";
                state.universalItems += 1;
                state.normalItems += 1;
                msg = "ğŸŒŸå¤§æˆåŠŸï¼ğŸŒŸ è·å¾—ä¸‡èƒ½é“å…·ï¼Œå¹¶è¿”è¿˜åˆå§‹é“å…·ï¼";
            }
            showToast(msg);
            state.inputSlots = 0;
            state.helpers = 0; 
            setTimeout(() => {
                state.isSmelting = false;
                el.furnace.innerText = "ğŸº";
                updateUI();
            }, 2000);
        }

        // --- UI æ›´æ–° ---
        function updateUI() {
            el.dailyLimit.innerText = state.attemptsLeft;
            el.normalCount.innerText = state.normalItems;
            el.universalCount.innerText = state.universalItems;
            el.myRewardsCount.innerText = state.myRewardsReceived;

            // æ§½ä½
            for (let i = 1; i <= 2; i++) {
                const slot = document.getElementById(`slot-${i}`);
                if (i <= state.inputSlots) {
                    slot.classList.add('filled');
                    slot.innerText = "ğŸ§ª";
                } else {
                    slot.classList.remove('filled');
                    slot.innerText = "";
                }
            }
            // åŠ©åŠ›å¤´åƒ
            for (let i = 1; i <= 3; i++) {
                const avatar = document.getElementById(`helper-${i}`);
                if (i <= state.helpers) {
                    avatar.classList.add('active');
                    avatar.innerText = "âš¡";
                } else {
                    avatar.classList.remove('active');
                    avatar.innerText = "";
                }
            }
            // æŒ‰é’®
            const canSmelt = (state.inputSlots === 2 && state.attemptsLeft > 0 && !state.isSmelting);
            el.btnSmelt.disabled = !canSmelt;
            el.btnAdd.disabled = state.isSmelting;

            // ç†”ç‚‰ç‰¹æ•ˆ
            el.furnace.className = "furnace"; 
            if (state.isSmelting) el.furnace.classList.add('smelting');
            el.furnace.classList.add(`lv${state.helpers}`);

            // æ¦‚ç‡æ–‡æ¡ˆ
            const data = PROB_TABLE[state.helpers];
            el.levelText.innerText = data.name;
            el.levelText.style.color = `var(--color-lv${state.helpers})`;
            el.probFail.innerText = data.fail + "%";
            el.probSuccess.innerText = data.success + "%";
            el.probGreat.innerText = data.great + "%";
        }

        function toggleProbability() {
            if (state.isSmelting) return;
            el.probTooltip.classList.toggle('show');
            if (el.probTooltip.classList.contains('show')) {
                setTimeout(() => el.probTooltip.classList.remove('show'), 3000);
            }
        }

        function showToast(text) {
            el.toast.innerText = text;
            el.toast.classList.add('show');
            setTimeout(() => el.toast.classList.remove('show'), 2500);
        }

        updateUI();
        
        // å…¨å±€ç‚¹å‡»ç›‘å¬ï¼Œå…³é—­å¼¹çª—
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.help-wrapper')) {
                el.helpTooltip.classList.remove('show');
            }
            if (!e.target.closest('.furnace-wrapper')) {
                el.probTooltip.classList.remove('show');
            }
        });

    </script>
</body>
</html>