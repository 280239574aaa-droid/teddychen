<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”ç‰©è®¨ä¼ - å®Œæ•´åŠŸèƒ½ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --highlight-color: #f1c40f;
            --poster-color: #e74c3c;
            --monster-size: 160px;
            --modal-bg: rgba(20, 20, 20, 0.95);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* --- é¡¶éƒ¨ UI --- */
        .top-layer {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 20px; box-sizing: border-box;
            display: flex; justify-content: space-between;
            align-items: flex-start; z-index: 10; pointer-events: none;
        }

        .activity-title {
            pointer-events: auto;
            font-size: 1.4rem; font-weight: 800;
            color: var(--highlight-color);
            border: 2px solid var(--highlight-color);
            padding: 8px 20px; border-radius: 30px;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
        }

        .top-menu { pointer-events: auto; display: flex; gap: 10px; }

        .menu-btn {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; padding: 8px 12px;
            border-radius: 12px; font-size: 0.8rem;
            cursor: pointer; display: flex; flex-direction: column;
            align-items: center; min-width: 60px;
            backdrop-filter: blur(4px); transition: 0.2s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .menu-icon { font-size: 1.2rem; margin-bottom: 2px; }

        /* --- ä¸­é—´é­”ç‰©åœºæ™¯ --- */
        .monster-scene {
            position: relative; flex: 1; width: 100%;
            display: flex; align-items: center; justify-content: center;
        }
        .monster-wrapper { position: relative; }

        .monster {
            font-size: var(--monster-size); cursor: pointer;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
            transition: transform 0.2s; position: relative; z-index: 2;
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes hardHit {
            0% { transform: scale(1); filter: brightness(1); }
            30% { transform: scale(1.3) rotate(5deg); filter: brightness(1) sepia(1) hue-rotate(-50deg) saturate(5); }
            50% { transform: translate(-5px, 0) skewX(10deg); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .monster.hit { animation: hardHit 0.4s ease-out; }

        @keyframes dieAndRespawn {
            0% { transform: scale(1); opacity: 1; }
            40% { transform: scale(0) rotate(180deg); opacity: 0; }
            60% { transform: scale(0) translateY(50px); opacity: 0; }
            80% { transform: scale(1.2) translateY(0); opacity: 1; }
            100% { transform: scale(1); }
        }
        .monster.respawn { animation: dieAndRespawn 0.8s ease-in-out; }

        /* æ³¢çº¹ & æ°”æ³¡ */
        .shockwave {
            position: absolute; top: 50%; left: 50%;
            width: 100px; height: 100px;
            background: rgba(255,255,255,0.6); border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            pointer-events: none; z-index: 1;
        }
        .shockwave.active { animation: wave 0.4s ease-out; }
        @keyframes wave { to { transform: translate(-50%, -50%) scale(4); opacity: 0; } }

        .speech-bubble {
            position: absolute; top: -20px; left: 50%;
            transform: translateX(-50%) scale(0);
            background-color: #fff; color: #333;
            padding: 8px 15px; border-radius: 15px;
            font-weight: bold; font-size: 1rem;
            white-space: nowrap; opacity: 0; pointer-events: none;
            transition: all 0.2s; z-index: 5;
        }
        .speech-bubble.show { opacity: 1; transform: translateX(-50%) scale(1); top: -80px; }

        /* --- åº•éƒ¨æ§åˆ¶åŒº --- */
        .bottom-panel {
            width: 90%; max-width: 700px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px; padding: 20px;
            margin-bottom: 30px;
            display: flex; align-items: center; gap: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .progress-wrapper {
            flex: 1; height: 30px;
            background-color: #34495e;
            border-radius: 15px; overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
            position: relative;
        }
        .progress-bar {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            transition: width 0.2s ease-out;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }

        .action-group { display: flex; flex-direction: column; gap: 10px; min-width: 170px; }

        .resources-row {
            display: flex; justify-content: space-between;
            font-size: 0.8rem; font-weight: bold;
            color: #bdc3c7; background: rgba(0,0,0,0.2);
            padding: 6px 10px; border-radius: 8px;
        }
        .res-item span { margin-left: 4px; font-size: 0.95rem; }
        .res-token span { color: var(--highlight-color); }
        .res-poster span { color: var(--poster-color); }

        .btn {
            width: 100%; padding: 10px 0;
            font-size: 0.95rem; border: none; border-radius: 8px;
            cursor: pointer; font-weight: bold;
            transition: all 0.1s; position: relative;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn:active { transform: scale(0.96); }
        .btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }

        .btn-attack { background: linear-gradient(to bottom, #e67e22, #d35400); color: white; box-shadow: 0 3px 0 #a04000; }
        .btn-attack:hover:not(:disabled) { filter: brightness(1.1); }

        .btn-challenge { background: #7f8c8d; color: #ecf0f1; box-shadow: 0 3px 0 #586364; }
        .btn-challenge.active { background: linear-gradient(to bottom, #e74c3c, #c0392b); color: white; box-shadow: 0 3px 0 #922b21; }

        /* --- å¼¹çª—æ ·å¼ (Modals) --- */
        .modal-overlay {
            display: none; /* é»˜è®¤éšè— */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: var(--modal-bg);
            width: 85%; max-width: 400px;
            border-radius: 20px;
            border: 1px solid #555;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            padding: 25px;
            text-align: center;
            color: white;
            transform: scale(0.8); opacity: 0;
            transition: all 0.3s;
        }
        .modal-overlay.open .modal-box { transform: scale(1); opacity: 1; }
        
        .modal-title { font-size: 1.5rem; color: var(--highlight-color); margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .close-btn {
            margin-top: 20px; padding: 10px 30px;
            background: #34495e; border: 1px solid #7f8c8d;
            color: white; border-radius: 20px; cursor: pointer;
        }
        .close-btn:hover { background: #2c3e50; }

        /* å¥–åŠ±åˆ—è¡¨ */
        .reward-item {
            background: rgba(255,255,255,0.05);
            margin-bottom: 15px; padding: 15px; border-radius: 10px;
            text-align: left;
        }
        .reward-label { font-size: 0.9rem; color: #bdc3c7; margin-bottom: 5px; }
        .reward-content { font-size: 1.1rem; color: #f1c40f; font-weight: bold; }

        /* æ’è¡Œæ¦œåˆ—è¡¨ */
        .rank-list { width: 100%; border-collapse: collapse; }
        .rank-list th { text-align: left; color: #7f8c8d; font-size: 0.8rem; padding-bottom: 10px; }
        .rank-list td { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .rank-list tr:last-child td { border-bottom: none; }
        .rank-num { width: 40px; font-weight: bold; color: #bdc3c7; }
        .rank-num.top1 { color: #f1c40f; } 
        .rank-num.top2 { color: #bdc3c7; } 
        .rank-num.top3 { color: #e67e22; }
        .rank-name { text-align: left; }
        .rank-score { text-align: right; color: #e74c3c; font-weight: bold; }
        .rank-myself { background: rgba(231, 76, 60, 0.1); } /* é«˜äº®è‡ªå·± */

        /* æµ®åŠ¨æ–‡å­— */
        .float-text {
            position: absolute; color: var(--poster-color);
            font-weight: bold; font-size: 1.5rem;
            pointer-events: none; z-index: 20;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 0 0 5px white;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨ -->
    <div class="top-layer">
        <div class="activity-title">é­”ç‰©è®¨ä¼</div>
        <div class="top-menu">
            <button class="menu-btn" onclick="openRankModal()">
                <span class="menu-icon">ğŸ†</span>æ’è¡Œæ¦œ
            </button>
            <button class="menu-btn" onclick="openRewardModal()">
                <span class="menu-icon">ğŸ</span>å¥–åŠ±é¢„è§ˆ
            </button>
        </div>
    </div>

    <!-- ä¸­é—´ -->
    <div class="monster-scene">
        <div class="monster-wrapper">
            <div class="shockwave" id="shockwave"></div>
            <div class="speech-bubble" id="dialog">...</div>
            <div class="monster" id="monster">ğŸ‘¹</div>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div class="bottom-panel">
        <!-- è¡€æ¡ -->
        <div class="progress-wrapper">
            <div class="progress-bar" id="hp-bar" style="width: 100%;">100%</div>
        </div>

        <!-- èµ„æºä¸æ“ä½œ -->
        <div class="action-group">
            <div class="resources-row">
                <div class="res-item res-token">è®¨ä¼ä»¤:<span id="token-count">20</span></div>
                <div class="res-item res-poster">é€šç¼‰ä»¤:<span id="poster-count">0</span></div>
            </div>

            <button class="btn btn-attack" id="attack-btn" onclick="attackMonster()">
                âš”ï¸ æ”»å‡»é­”ç‰©
            </button>
            
            <button class="btn btn-challenge" id="challenge-btn" onclick="usePoster()" disabled>
                ğŸ“œ å‰å¾€è®¨ä¼BOSS
            </button>
        </div>
    </div>

    <!-- å¼¹çª—ï¼šå¥–åŠ±é¢„è§ˆ -->
    <div class="modal-overlay" id="reward-modal">
        <div class="modal-box">
            <div class="modal-title">ğŸ å¥–åŠ±ä¸€è§ˆ</div>
            
            <div class="reward-item">
                <div class="reward-label">å‘èµ· BOSS æŒ‘æˆ˜å¹¶èƒœåˆ©</div>
                <div class="reward-content">è·å¾—ï¼šå± é¾™å®åˆ€ x1</div>
            </div>
            
            <div class="reward-item">
                <div class="reward-label">å‚ä¸ BOSS æŒ‘æˆ˜å¹¶èƒœåˆ©</div>
                <div class="reward-content">è·å¾—ï¼šå‹‡è€…é‡‘å¸ x1000</div>
            </div>

            <button class="close-btn" onclick="closeModals()">å…³é—­</button>
        </div>
    </div>

    <!-- å¼¹çª—ï¼šæ’è¡Œæ¦œ -->
    <div class="modal-overlay" id="rank-modal">
        <div class="modal-box">
            <div class="modal-title">ğŸ† ä¼¤å®³æ’è¡Œæ¦œ</div>
            <table class="rank-list" id="rank-table-body">
                <!-- JS åŠ¨æ€ç”Ÿæˆ -->
            </table>
            <div style="margin-top: 15px; font-size: 0.8rem; color: #7f8c8d;">
                *æ ¹æ®æ‰“æ‰é­”ç‰©çš„æ€»è¡€é‡æ’å
            </div>
            <button class="close-btn" onclick="closeModals()">å…³é—­</button>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆæ•°æ® ---
        const CONFIG = {
            damagePerHit: 20,
            hpMax: 100
        };

        let state = {
            hp: 100,
            tokens: 20,
            posters: 0,
            totalDamage: 0, // è®°å½•ç©å®¶é€ æˆçš„æ€»ä¼¤å®³
            isRespawning: false
        };

        const dialogTexts = ["å¥½ç—›ï¼", "è¿˜æ²¡å®Œå‘¢ï¼", "å¯æ¶å•Šï¼", "åˆ«å¤ªåš£å¼ ï¼", "æˆ‘ä¼šå›æ¥çš„ï¼"];

        // --- DOM å…ƒç´  ---
        const el = {
            monster: document.getElementById('monster'),
            shockwave: document.getElementById('shockwave'),
            dialog: document.getElementById('dialog'),
            hpBar: document.getElementById('hp-bar'),
            tokenCount: document.getElementById('token-count'),
            posterCount: document.getElementById('poster-count'),
            attackBtn: document.getElementById('attack-btn'),
            challengeBtn: document.getElementById('challenge-btn'),
            monsterWrapper: document.querySelector('.monster-wrapper'),
            rewardModal: document.getElementById('reward-modal'),
            rankModal: document.getElementById('rank-modal'),
            rankTable: document.getElementById('rank-table-body')
        };

        // --- åˆå§‹åŒ– ---
        updateUI();

        // --- æ ¸å¿ƒé€»è¾‘ï¼šæ”»å‡» ---
        function attackMonster() {
            if (state.isRespawning) return;
            if (state.tokens <= 0) {
                alert("è®¨ä¼ä»¤ä¸è¶³ï¼");
                return;
            }

            // 1. æ•°æ®å˜åŠ¨
            state.tokens--;
            state.hp -= CONFIG.damagePerHit;
            state.totalDamage += CONFIG.damagePerHit; // ç´¯ç§¯æ€»ä¼¤å®³

            if (state.hp < 0) state.hp = 0;

            // 2. ç‰¹æ•ˆä¸UI
            triggerHitEffect();
            updateUI();

            // 3. åˆ¤å®š
            if (state.hp <= 0) {
                handleKill();
            } else {
                const text = dialogTexts[Math.floor(Math.random() * dialogTexts.length)];
                showDialog(text);
            }
        }

        function handleKill() {
            state.isRespawning = true;
            state.posters++;
            showFloatingText("+1 é€šç¼‰ä»¤");
            showDialog("æˆ‘ä¸ç”˜å¿ƒ...ï¼");

            // å¤æ´»æµç¨‹
            setTimeout(() => {
                el.monster.classList.remove('hit');
                el.monster.classList.add('respawn');
                
                setTimeout(() => {
                    state.hp = CONFIG.hpMax;
                    state.isRespawning = false;
                    updateUI();
                    
                    setTimeout(() => {
                        el.monster.classList.remove('respawn');
                    }, 400);
                }, 400);
            }, 300);
        }

        function usePoster() {
            if (state.posters <= 0) return;
            const confirmAction = confirm(`ç¡®è®¤æ¶ˆè€—1å¼ é€šç¼‰ä»¤ï¼Ÿ\n\nå‘èµ·æŒ‘æˆ˜å¯è·å¾—ï¼šå± é¾™å®åˆ€\nå‚ä¸æŒ‘æˆ˜å¯è·å¾—ï¼šå‹‡è€…é‡‘å¸`);
            if (confirmAction) {
                state.posters--;
                updateUI();
                alert("æ­£åœ¨å‰å¾€BOSSæˆ˜åœº...");
            }
        }

        // --- å¼¹çª—é€»è¾‘ ---
        function openRewardModal() {
            closeModals();
            el.rewardModal.style.display = 'flex';
            // å¼ºåˆ¶é‡ç»˜è§¦å‘ transition
            setTimeout(() => el.rewardModal.classList.add('open'), 10);
        }

        function openRankModal() {
            closeModals();
            generateRanking(); // ç”Ÿæˆæ’è¡Œæ¦œæ•°æ®
            el.rankModal.style.display = 'flex';
            setTimeout(() => el.rankModal.classList.add('open'), 10);
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('open');
                setTimeout(() => {
                    if(!modal.classList.contains('open')) modal.style.display = 'none';
                }, 300);
            });
        }

        // --- æ’è¡Œæ¦œæ•°æ®ç”Ÿæˆ ---
        function generateRanking() {
            // 1. æ¨¡æ‹Ÿä¸€äº›å‡æ•°æ®
            let rankingData = [
                { name: "é¾™éª‘å£«_Alex", damage: 8500 },
                { name: "è·¯äººç”²", damage: 4200 },
                { name: "æ‰“æ€ªä¸“å®¶", damage: 3600 },
                { name: "æ‘¸é±¼è¾¾äºº", damage: 1200 },
                { name: "æ–°æ‰‹ç©å®¶", damage: 400 }
            ];

            // 2. æŠŠè‡ªå·±åŠ è¿›å»
            rankingData.push({ name: "æˆ‘ (YOU)", damage: state.totalDamage, isMe: true });

            // 3. æ’åº (ä¼¤å®³ä»é«˜åˆ°ä½)
            rankingData.sort((a, b) => b.damage - a.damage);

            // 4. ç”Ÿæˆ HTML
            let html = `<tr><th>æ’å</th><th>ç©å®¶</th><th>æ€»ä¼¤å®³</th></tr>`;
            rankingData.forEach((item, index) => {
                const rank = index + 1;
                const rowClass = item.isMe ? 'rank-myself' : '';
                const rankClass = rank <= 3 ? `top${rank}` : '';
                
                html += `
                    <tr class="${rowClass}">
                        <td class="rank-num ${rankClass}">${rank}</td>
                        <td class="rank-name">${item.name}</td>
                        <td class="rank-score">${item.damage}</td>
                    </tr>
                `;
            });
            el.rankTable.innerHTML = html;
        }

        // --- è§†è§‰ç‰¹æ•ˆ ---
        function triggerHitEffect() {
            el.monster.classList.remove('hit');
            el.shockwave.classList.remove('active');
            void el.monster.offsetWidth;
            void el.shockwave.offsetWidth;
            el.monster.classList.add('hit');
            el.shockwave.classList.add('active');
        }

        function showFloatingText(text) {
            const floatEl = document.createElement('div');
            floatEl.className = 'float-text';
            floatEl.innerText = text;
            const randomX = (Math.random() - 0.5) * 50;
            floatEl.style.transform = `translateX(${randomX}px)`;
            el.monsterWrapper.appendChild(floatEl);
            setTimeout(() => floatEl.remove(), 1000);
        }

        let dialogTimer;
        function showDialog(text) {
            el.dialog.innerText = text;
            el.dialog.classList.add('show');
            clearTimeout(dialogTimer);
            dialogTimer = setTimeout(() => {
                el.dialog.classList.remove('show');
            }, 800);
        }

        // --- UI æ›´æ–° ---
        function updateUI() {
            el.tokenCount.innerText = state.tokens;
            el.posterCount.innerText = state.posters;
            
            const pct = (state.hp / CONFIG.hpMax) * 100;
            el.hpBar.style.width = pct + '%';
            el.hpBar.innerText = state.hp + '%';

            el.attackBtn.disabled = (state.tokens <= 0 || state.isRespawning);
            
            if (state.posters > 0) {
                el.challengeBtn.disabled = false;
                el.challengeBtn.classList.add('active');
                el.challengeBtn.innerText = "ğŸ”¥ å‘èµ·BOSSæŒ‘æˆ˜";
            } else {
                el.challengeBtn.disabled = true;
                el.challengeBtn.classList.remove('active');
                el.challengeBtn.innerText = "ğŸ“œ å‰å¾€è®¨ä¼BOSS";
            }
        }
    </script>
</body>
</html>